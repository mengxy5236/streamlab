# StreamLab TODO 待实现功能

## 🔴 高优先级（P0）

### 1. WebSocket 弹幕实时通信
- [ ] 引入 spring-boot-starter-websocket 依赖
- [ ] 配置 WebSocket STOMP 协议
- [ ] 实现 `/topic/danmaku/{videoId}` 订阅
- [ ] 实现 `/api/danmaku` 发送接口
- [ ] 服务端广播弹幕到对应频道

**相关文件**：`danmaku/Danmaku.java`

---

## 🟡 中优先级（P1）

### 2. 视频转码功能
- [ ] **VideoProcessor.java:45** - 调用 FFmpeg 提取视频时长
- [ ] 视频格式转码（支持多种格式转 MP4）
- [ ] 多分辨率生成（1080p/720p/480p）
- [ ] 封面截图提取

### 3. 文件存储扩展
- [ ] 集成阿里云 OSS / 腾讯云 COS
- [ ] 切换到对象存储（低代码改动）
- [ ] 配置 CDN 加速

### 4. AIOps 能力初探
- [ ] **DanmakuService** - 高压力时弹幕入 MQ 队列
- [ ] 系统压力检测（CPU > 80%）
- [ ] 结构化日志（KEY=VALUE 格式）
- [ ] Actuator 指标采集

---

## 🟢 低优先级（P2）

### 5. 性能优化
- [ ] Redis 缓存（热点数据）
- [ ] 接口限流（Sentinel / Resilience4j）
- [ ] 数据库读写分离

### 6. 用户体验
- [ ] 断点续传（前端分片上传）
- [ ] 上传进度实时推送
- [ ] 视频发布审核流程

### 7. 社交功能完善
- [ ] 用户消息通知系统
- [ ] 评论 @提及功能
- [ ] 私信聊天

---

## 🚀 进阶路线（未来规划）

### 阶段 1：Redis 缓存与实时统计
- [ ] Redis 集成
  - 视频详情缓存（Cache-Aside 模式）
  - 用户信息缓存
  - 热门视频列表缓存
- [ ] 实时计数器
  - 播放量实时计数（Redis INCR）
  - 点赞/投币/收藏计数
  - 定时任务：Redis → MySQL 批量同步
- [ ] 排行榜
  - 日榜/周榜/月榜（Redis Sorted Set）
  - 分区排行榜

### 阶段 2：Kafka 事件驱动
- [ ] Kafka 集成
  - 视频上传事件 `video.upload.event`
  - 用户行为埋点 `user.action.event`
  - 弹幕消息 `danmaku.event`
- [ ] 异步处理
  - 视频转码任务
  - 统计更新
  - 通知发送

### 阶段 3：Elasticsearch 搜索
- [ ] 全文搜索
  - 标题 + 描述搜索
  - 中文分词（IK Analyzer）
  - 搜索高亮
- [ ] 数据同步
  - 视频创建/更新时同步到 ES
  - 全量数据导入

### 阶段 4：性能优化
- [ ] 压测
  - JMeter 压测脚本
  - QPS 目标：5000+
- [ ] 优化
  - MySQL 慢查询优化
  - JVM 参数调优
  - 接口限流熔断

---

## 📋 功能检查清单

### 阶段一：基础环境 ✅ 已完成
- [x] Spring Boot 项目（Java 21+）
- [x] MySQL 数据库连通
- [x] Flyway 迁移管理
- [x] 统一异常处理

### 阶段二：核心业务 CRUD ✅ 已完成
- [x] 用户注册/登录（JWT + BCrypt）
- [x] 视频元数据管理
- [x] 视频上传（本地存储）
- [x] 视频列表分页
- [x] 点赞/投币/收藏
- [x] 用户关注

### 阶段三：高光功能 - 弹幕系统 ⏳ 进行中
- [x] 弹幕数据模型设计
- [x] 弹幕 CRUD 接口
- [ ] **WebSocket 实时通信** ← 当前任务

### 阶段四：AIOps 能力 ⏳ 预留
- [ ] 结构化日志
- [ ] 指标采集
- [ ] 规则引擎雏形
- [ ] MQ 消息队列集成

---

## 🏗 架构演进路线

```
本地存储 → 对象存储(OSS) → CDN加速 → 多分辨率转码 → 智能推荐
   ↓            ↓              ↓           ↓            ↓
  现在       低成本方案      中期方案    YouTube级别   终极目标
```

---

**技术栈目标**：
- Redis 7.x - 缓存 + 计数器 + 排行榜
- Kafka 3.x - 消息队列/事件总线
- Elasticsearch 8.x - 全文搜索
- MinIO - 对象存储（模拟 OSS）
- Docker Compose - 容器化部署

---

*文档版本: 2.0*
*最后更新: 2026-02-05*
